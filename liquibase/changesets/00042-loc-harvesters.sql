--liquibase formatted sql
--changeset joachim:00042-loc-harvesters contextFilter:loc

-- insert four default test harvesters
-- - create temp table to contain the desired config
-- - merge that temp table with the existing harvester configs, bumping all ID values with the current maximum
create table harvestersettingstemp as table harvestersettings with no data;

insert into harvestersettingstemp (id, encrypted, name, value, parentid)
values (100, 'n', 'node', 'ogcwxs', 1),
       (101, 'n', 'site', '', 100),
       (102, 'n', 'translations', '', 101),
       (103, 'n', 'options', '', 100),
       (104, 'n', 'info', '', 100),
       (105, 'n', 'content', '', 100),
       (106, 'n', 'name', '[test] WMS', 101),
       (107, 'n', 'uuid', 'aaf58a16-8568-4cdf-aaf4-946f3fcafc42', 101),
       (108, 'n', 'ownerId', '1', 101),
       (109, 'n', 'ownerUser', 'undefined', 101),
       (110, 'n', 'ownerGroup', '102', 101),
       (111, 'n', 'useAccount', 'false', 101),
       (112, 'n', 'username', '', 111),
       (113, 'y', 'password', '', 111),
       (114, 'n', 'every', '0 0 0 ? * *', 103),
       (115, 'n', 'oneRunOnly', 'false', 103),
       (116, 'n', 'overrideUUID', 'SKIP', 103),
       (117, 'n', 'ifRecordExistAppendPrivileges', 'false', 103),
       (118, 'n', 'status', 'active', 103),
       (119, 'n', 'importxslt', 'none', 105),
       (120, 'n', 'batchEdits', '', 105),
       (121, 'n', 'validate', 'SCHEMATRONVALIDATION', 105),
       (122, 'n', 'lastRun', '', 104),
       (123, 'n', 'privileges', '', 100),
       (124, 'n', 'group', '1', 123),
       (125, 'n', 'operation', '0', 124),
       (126, 'n', 'operation', '5', 124),
       (127, 'n', 'operation', '1', 124),
       (128, 'n', 'categories', '', 100),
       (129, 'n', 'url', 'https://geo.api.vlaanderen.be/GRB/wms?request=GetCapabilities', 101),
       (130, 'n', 'icon', 'blank.png', 101),
       (131, 'n', 'ogctype', 'WMS1.3.0', 101),
       (132, 'n', 'lang', 'eng', 103),
       (133, 'n', 'topic', '', 103),
       (134, 'n', 'createThumbnails', 'false', 103),
       (135, 'n', 'useLayer', 'false', 103),
       (136, 'n', 'datasetTemplateUuid', '', 103),
       (137, 'n', 'serviceTemplateUuid', '', 103),
       (138, 'n', 'useLayerMd', 'false', 103),
       (139, 'n', 'datasetCategory', '', 103),
       (140, 'n', 'outputSchema', 'iso19139', 103),
       (141, 'n', 'node', 'ogcwxs', 1),
       (142, 'n', 'site', '', 141),
       (143, 'n', 'translations', '', 142),
       (144, 'n', 'options', '', 141),
       (145, 'n', 'info', '', 141),
       (146, 'n', 'content', '', 141),
       (147, 'n', 'name', '[test] WCS', 142),
       (148, 'n', 'uuid', 'e8333bdb-2ba5-4565-aefb-4e3aa7cfa87d', 142),
       (149, 'n', 'ownerId', '1', 142),
       (150, 'n', 'ownerUser', 'undefined', 142),
       (151, 'n', 'ownerGroup', '102', 142),
       (152, 'n', 'useAccount', 'false', 142),
       (153, 'n', 'username', '', 152),
       (154, 'y', 'password', '', 152),
       (155, 'n', 'every', '0 0 0 ? * *', 144),
       (156, 'n', 'oneRunOnly', 'false', 144),
       (157, 'n', 'overrideUUID', 'SKIP', 144),
       (158, 'n', 'ifRecordExistAppendPrivileges', 'false', 144),
       (159, 'n', 'status', 'active', 144),
       (160, 'n', 'importxslt', 'none', 146),
       (161, 'n', 'batchEdits', '', 146),
       (162, 'n', 'validate', 'NOVALIDATION', 146),
       (163, 'n', 'lastRun', '', 145),
       (164, 'n', 'privileges', '', 141),
       (165, 'n', 'group', '1', 164),
       (166, 'n', 'operation', '0', 165),
       (167, 'n', 'operation', '5', 165),
       (168, 'n', 'operation', '1', 165),
       (169, 'n', 'categories', '', 141),
       (170, 'n', 'url', 'https://geo.api.vlaanderen.be/el-dtm/wcs', 142),
       (171, 'n', 'icon', 'blank.png', 142),
       (172, 'n', 'ogctype', 'WCS2.0.0', 142),
       (173, 'n', 'lang', 'eng', 144),
       (174, 'n', 'topic', '', 144),
       (175, 'n', 'createThumbnails', 'false', 144),
       (176, 'n', 'useLayer', 'false', 144),
       (177, 'n', 'datasetTemplateUuid', '', 144),
       (178, 'n', 'serviceTemplateUuid', '', 144),
       (179, 'n', 'useLayerMd', 'false', 144),
       (180, 'n', 'datasetCategory', '', 144),
       (181, 'n', 'outputSchema', 'iso19139', 144),
       (182, 'n', 'node', 'ogcwxs', 1),
       (223, 'n', 'node', 'ogcwxs', 1),
       (264, 'n', 'site', '', 223),
       (265, 'n', 'translations', '', 264),
       (266, 'n', 'options', '', 223),
       (267, 'n', 'info', '', 223),
       (268, 'n', 'content', '', 223),
       (269, 'n', 'name', '[test] WFS', 264),
       (270, 'n', 'uuid', '144c92a8-5c60-429b-92f2-6361bbe47d4b', 264),
       (271, 'n', 'ownerId', '1', 264),
       (272, 'n', 'ownerUser', '', 264),
       (273, 'n', 'ownerGroup', '102', 264),
       (274, 'n', 'useAccount', 'false', 264),
       (275, 'n', 'username', '', 274),
       (276, 'y', 'password', '', 274),
       (277, 'n', 'every', '0 0 0 ? * *', 266),
       (278, 'n', 'oneRunOnly', 'false', 266),
       (279, 'n', 'overrideUUID', 'SKIP', 266),
       (280, 'n', 'ifRecordExistAppendPrivileges', 'false', 266),
       (281, 'n', 'status', 'active', 266),
       (282, 'n', 'importxslt', 'none', 268),
       (283, 'n', 'batchEdits', '', 268),
       (284, 'n', 'validate', 'NOVALIDATION', 268),
       (285, 'n', 'lastRun', '', 267),
       (286, 'n', 'privileges', '', 223),
       (287, 'n', 'group', '1', 286),
       (288, 'n', 'operation', '0', 287),
       (289, 'n', 'operation', '5', 287),
       (290, 'n', 'operation', '1', 287),
       (291, 'n', 'categories', '', 223),
       (292, 'n', 'url', 'https://geo.api.vlaanderen.be/Wegenregister/wfs', 264),
       (293, 'n', 'icon', 'blank.png', 264),
       (294, 'n', 'ogctype', 'WFS1.1.0', 264),
       (295, 'n', 'lang', 'eng', 266),
       (296, 'n', 'topic', '', 266),
       (297, 'n', 'createThumbnails', 'false', 266),
       (298, 'n', 'useLayer', 'false', 266),
       (299, 'n', 'datasetTemplateUuid', '', 266),
       (300, 'n', 'serviceTemplateUuid', '', 266),
       (301, 'n', 'useLayerMd', 'false', 266),
       (302, 'n', 'datasetCategory', '', 266),
       (303, 'n', 'outputSchema', 'iso19139', 266),
       (344, 'n', 'site', '', 182),
       (345, 'n', 'translations', '', 344),
       (346, 'n', 'options', '', 182),
       (347, 'n', 'info', '', 182),
       (348, 'n', 'content', '', 182),
       (349, 'n', 'name', '[test] WMTS', 344),
       (350, 'n', 'uuid', 'cf0c9638-edbf-4e34-9955-96bf83678ccc', 344),
       (351, 'n', 'ownerId', '1', 344),
       (352, 'n', 'ownerUser', '', 344),
       (353, 'n', 'ownerGroup', '102', 344),
       (354, 'n', 'useAccount', 'false', 344),
       (355, 'n', 'username', '', 354),
       (356, 'y', 'password', '', 354),
       (357, 'n', 'every', '0 0 0 ? * *', 346),
       (358, 'n', 'oneRunOnly', 'false', 346),
       (359, 'n', 'overrideUUID', 'SKIP', 346),
       (360, 'n', 'ifRecordExistAppendPrivileges', 'false', 346),
       (361, 'n', 'status', 'active', 346),
       (362, 'n', 'importxslt', 'none', 348),
       (363, 'n', 'batchEdits', '', 348),
       (364, 'n', 'validate', 'SCHEMATRONVALIDATION', 348),
       (365, 'n', 'lastRun', '', 347),
       (366, 'n', 'privileges', '', 182),
       (367, 'n', 'group', '1', 366),
       (368, 'n', 'operation', '0', 367),
       (369, 'n', 'operation', '5', 367),
       (370, 'n', 'operation', '1', 367),
       (371, 'n', 'categories', '', 182),
       (372, 'n', 'url', 'https://geo.api.vlaanderen.be/histcart/wmts', 344),
       (373, 'n', 'icon', 'blank.png', 344),
       (374, 'n', 'ogctype', 'WMTS1.1.0', 344),
       (375, 'n', 'lang', 'eng', 346),
       (376, 'n', 'topic', '', 346),
       (377, 'n', 'createThumbnails', 'false', 346),
       (378, 'n', 'useLayer', 'false', 346),
       (379, 'n', 'datasetTemplateUuid', '', 346),
       (380, 'n', 'serviceTemplateUuid', '', 346),
       (381, 'n', 'useLayerMd', 'false', 346),
       (382, 'n', 'datasetCategory', '', 346),
       (383, 'n', 'outputSchema', 'iso19139', 346);

insert into harvestersettings (select id + (select max(id) from harvestersettings),
                                      encrypted,
                                      name,
                                      value,
                                      -- the only reference we don't want to bump is '1' - the default config node
                                      case when parentid = 1 then 1 else parentid + (select max(id) from harvestersettings) end
                               from harvestersettingstemp);

drop table harvestersettingstemp;

-- bump the sequence beyond our new values
select setval('harvester_setting_id_seq', (select max(id) + 1 from harvestersettings), false);
